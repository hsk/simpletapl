# TAPL26,28 有界量化 有界量化のメタ理論

## 図26-1.有界量化（カーネルF<:）

  → ∀ <: Top   System F(図23-1)と単調型付け(図15-1)に基づく
  構文
  t ::=      項：
    x        変数
    λx:T.t   ラムダ抽象
    t t      関数適用
    λX<:T.t  型抽象
    t [T]    型適用
  v ::=      値：
    λx:T.t   ラムダ抽象値
    λX<:T.t  型抽象値
  T ::=      型：
    X        型変数
    Top      最大の型
    T->T     関数の型
    ∀X<:T.T  全称型
  Γ::=       文脈：
    ∅       からの文脈
    Γ,x:T    項変数の束縛
    Γ,X<:T   型変数の束縛

  評価 t ==> t’

  t1 ==> t1’
  -------------------------------- (E-App1)
  t1 t2 ==> t1’ t2

  t2 ==> t2’
  -------------------------------- (E-App2)
  v1 t2 ==> v1 t2’

  t1 ==> t1’
  -------------------------------- (E-TApp)
  t1 [T2] ==> t1’ [T2]

  (λX<:T11.t12)[T2] ==> [X->T2]t12 (E-TAppTAbs)
  (λx:T11.t12) v2 ==> [x->v2]t12   (E-AppAbs)

  部分型付け S <: T

  Γ ⊢ S <: S                        (S-Refl)

  Γ ⊢ S <: U　　Γ ⊢ U <: T
  --------------------------------- (S-Trans)
  Γ ⊢ S <: T

  Γ ⊢ S <: Top                      (S-Top)

  X <: T∈Γ
  --------------------------------- (S-TVar)
  Γ ⊢ X <: T

  Γ ⊢ T1 <: S1　　Γ ⊢ S2 <: T2
  --------------------------------- (S-Arrow)
  Γ ⊢ S1 -> S2 <: T1 -> T2

  Γ,X<:U1 ⊢ S2 <: T2
  --------------------------------- (S-All)
  Γ ⊢ ∀X<:U1.S2 <: ∀X<:U1.T2

  型付け Γ ⊢ t : T

  x : T ∈ Γ
  ------------------------------------ (T-Var)
  Γ ⊢ x : T

  Γ,x:T1 ⊢ t2 : T2
  ------------------------------------ (T-Abs)
  Γ ⊢ λx:T1.t2 : T1 -> T2

  Γ ⊢ t1 : T11 -> T12　　Γ ⊢ t2 : T11
  ------------------------------------ (T-App)
  Γ ⊢ t1 t2 : T12

  Γ,X<:T1 ⊢ t2 : T2
  -------------------------------------- (T-TAbs)
  Γ ⊢ λX<:T1.t2 : ∀X.T2

  Γ ⊢ t1 : ∀X<:T11.T12   Γ ⊢ T2 <: T11
  -------------------------------------- (T-TApp)
  Γ ⊢ t1[T2] : [X -> T2] T12

  Γ ⊢ t : S   Γ ⊢ S <: T   
  -------------------------------------- (T-Sub)
  Γ ⊢ t : T

## 図28-1.F<:の型露出アルゴリズム

  → ∀ <: Top

    露出 Γ ↦ T ⇑ T’

    X <: T ∈ Γ   Γ ↦ T ⇑ T’
    --------------------------- (XA-Promote)
    Γ ↦ X ⇑ T’

    Tは型変数でない
    --------------------------- (XA-Other)
    Γ ↦ T ⇑ T


## 図28-2.F<:のアルゴリズム的型付け

  → ∀ <: Top    λ<: (図16-3)の拡張

    アルゴリズム的型付け Γ ↦ t : T

    x : T ∈ Γ
    ------------------------------------ (TA-Var)
    Γ ↦ x : T

    Γ,x:T1 ↦ t2 : T2
    ------------------------------------ (TA-Abs)
    Γ ↦ λx:T1.t2 : T1 -> T2

    Γ ↦ t1 : T1　　Γ ↦ T1 ⇑ T11 -> T12
    Γ ↦ t2 : T2　　Γ ↦ T2 <: T11
    ------------------------------------ (TA-App)
    Γ ↦ t1 t2 : T12

    Γ,X<:T1 ↦ t2 : T2


## 図28-3.カーネルF<:のアルゴリズム的部分型付け

  → ∀ <: Top    λ<: (図16-2)の拡張

    アルゴリズム的部分型付け |-> S <: T

    Γ |-> S <: Top                           (SA-Top)

    Γ |-> X <: X                       (SA-Refl-TVar)

    X <: U ∈ Γ   Γ |-> U <: T
    --------------------------------- (SA-Trans-TVar)
    Γ |-> X <: T

    Γ |-> T1 <: S1　　Γ |-> S2 <: T2
    -------------------------------------- (SA-Arrow)
    Γ |-> S1 -> S2 <: T1 -> T2

    Γ,X<:U1 |-> S2 <: T2
    ---------------------------------------- (SA-All)
    Γ |-> ∀X<:U1.S2 <: ∀X<:U1.T2



## 図28-4.フルF<:のアルゴリズム的部分型付け

  → ∀ <: Top フル    図28-1の拡張

    アルゴリズム的部分型付け |-> S <: T

    Γ |-> S <: Top                           (SA-Top)

    Γ |-> X <: X                       (SA-Refl-TVar)

    X <: U ∈ Γ   Γ |-> U <: T
    --------------------------------- (SA-Trans-TVar)
    Γ |-> X <: T

    Γ |-> T1 <: S1　　Γ |-> S2 <: T2
    -------------------------------------- (SA-Arrow)
    Γ |-> S1 -> S2 <: T1 -> T2

    Γ |-> T1 <: S1   Γ,X<:T1 |-> S2 <: T2
    ---------------------------------------- (SA-All)
    Γ |-> ∀X<:S1.S2 <: ∀X<:T1.T2



## 図28-5.カーネルF<:の結びと交わりを求めるアルゴリズム

  → ∀ <: Top

    Γ ⊢ S ∨ T =
        T            Γ ⊢ S <: Tの場合
        S            Γ ⊢ T <: Sの場合
        J            S = X
                     X<:U ∈ Γ
                     Γ ⊢ U ∨ T = Jの場合
        J            T = X
                     X<:U ∈ Γ
                     Γ ⊢ S ∨ U = Jの場合
        M1->J2       S = S1->S2
                     T = T1->T2
                     Γ ⊢ S1 ∨ T1 = M1
                     Γ ⊢ S2 ∨ T2 = J2の場合
        ∀X<:U1.J2   S = ∀X<:U1.S2
                     T = ∀X<:U1.T2
                     Γ,X<:U1 ⊢ S2 ∨ T2 = J2
                        の場合
        Top          それ以外の場合

    Γ ⊢ S ∧ T =
        S            Γ ⊢ S <: Tの場合
        T            Γ ⊢ T <: Sの場合
        J1->M2       S = S1->S2
                     T = T1->T2
                     Γ ⊢ S1 ∨ T1 = J1
                     Γ ⊢ S2 ∧ T2 = M2の場合
        ∀X<:U1.M2   S = ∀X<:U1.S2
                     T = ∀X<:U1.T2
                     Γ,X<:U1 ⊢ S2 ∧ T2 = M2
                        の場合
        fail         それ以外の場合

